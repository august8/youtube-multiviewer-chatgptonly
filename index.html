<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>アスペクト比を保った動画表示と操作パネル</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        overflow: hidden;
        background-color: #121212;
        color: #f0f0f0;
      }
      .video-container {
        display: grid;
        justify-content: center;
        align-content: center;
        width: 100vw;
        height: calc(100vh - 60px); /* 操作パネルを除外 */
        gap: 10px;
      }
      iframe {
        border: none;
        width: 100%;
        height: 100%;
        object-fit: contain;
        aspect-ratio: 16 / 9;
        background: #000;
      }
      .controls-container {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: #1e1e1e;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.5);
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        padding: 10px;
        transform: translateY(100%);
        transition: transform 0.3s ease-in-out;
      }
      .controls-container.visible {
        transform: translateY(0);
      }
      .toggle-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 15px;
        font-size: 16px;
        border: none;
        border-radius: 50%;
        background: #007bff;
        color: #fff;
        cursor: pointer;
        z-index: 1000;
      }
      .toggle-controls:hover {
        background: #0056b3;
      }
      button,
      input {
        margin: 5px;
        padding: 10px 15px;
        font-size: 14px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      input {
        flex: 1;
      }
      button {
        background: #007bff;
        color: #fff;
      }
      button:hover {
        background: #0056b3;
      }
      .reset {
        background: #dc3545;
      }
      .reset:hover {
        background: #a71d2a;
      }
    </style>
  </head>
  <body>
    <div class="video-container" id="videoContainer"></div>
    <div class="controls-container" id="controlsContainer">
      <input type="text" id="videoUrl" placeholder="YouTube動画のURLを入力" />
      <button id="addVideo">追加</button>
      <button id="resetVideos" class="reset">リセット</button>
      <button id="playAll">すべて再生</button>
      <button id="pauseAll">すべて一時停止</button>
      <button id="muteAll">すべてミュート</button>
      <button id="unmuteAll">すべてミュート解除</button>
    </div>
    <button class="toggle-controls" id="toggleControls">☰</button>

    <script>
      const videoContainer = document.getElementById("videoContainer");
      const videoUrlInput = document.getElementById("videoUrl");
      const controlsContainer = document.getElementById("controlsContainer");
      const toggleButton = document.getElementById("toggleControls");

      function extractVideoId(url) {
        const match = url.match(
          /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/
        );
        return match ? match[1] : null;
      }

      function adjustVideoGrid() {
        const videoCount = videoContainer.children.length;
        if (videoCount === 0) return;

        const aspectRatio = 16 / 9;
        const containerWidth = window.innerWidth;
        const containerHeight = window.innerHeight - 60; // 操作パネルの高さを除外

        let rows = Math.ceil(
          Math.sqrt(
            (videoCount * containerHeight) / (containerWidth * aspectRatio)
          )
        );
        let cols = Math.ceil(videoCount / rows);

        const maxVideoWidth = containerWidth / cols;
        const maxVideoHeight = containerHeight / rows;

        const videoWidth = Math.min(
          maxVideoWidth,
          maxVideoHeight * aspectRatio
        );
        const videoHeight = videoWidth / aspectRatio;

        videoContainer.style.gridTemplateColumns = `repeat(${cols}, ${videoWidth}px)`;
        videoContainer.style.gridTemplateRows = `repeat(${rows}, ${videoHeight}px)`;
      }

      document.getElementById("addVideo").addEventListener("click", () => {
        const videoId = extractVideoId(videoUrlInput.value.trim());
        if (videoId) {
          const iframe = document.createElement("iframe");
          iframe.src = `https://www.youtube.com/embed/${videoId}?enablejsapi=1`;
          iframe.allowFullscreen = true;
          videoContainer.appendChild(iframe);
          adjustVideoGrid();
          videoUrlInput.value = "";
        } else {
          alert("正しいYouTubeのURLを入力してください。");
        }
      });

      document.getElementById("resetVideos").addEventListener("click", () => {
        videoContainer.innerHTML = "";
        adjustVideoGrid();
      });

      document.getElementById("playAll").addEventListener("click", () => {
        document.querySelectorAll("iframe").forEach((iframe) => {
          iframe.contentWindow.postMessage(
            '{"event":"command","func":"playVideo","args":""}',
            "*"
          );
        });
      });

      document.getElementById("pauseAll").addEventListener("click", () => {
        document.querySelectorAll("iframe").forEach((iframe) => {
          iframe.contentWindow.postMessage(
            '{"event":"command","func":"pauseVideo","args":""}',
            "*"
          );
        });
      });

      document.getElementById("muteAll").addEventListener("click", () => {
        document.querySelectorAll("iframe").forEach((iframe) => {
          iframe.contentWindow.postMessage(
            '{"event":"command","func":"mute","args":""}',
            "*"
          );
        });
      });

      document.getElementById("unmuteAll").addEventListener("click", () => {
        document.querySelectorAll("iframe").forEach((iframe) => {
          iframe.contentWindow.postMessage(
            '{"event":"command","func":"unMute","args":""}',
            "*"
          );
        });
      });

      toggleButton.addEventListener("click", () => {
        controlsContainer.classList.toggle("visible");
      });

      window.addEventListener("resize", adjustVideoGrid);
    </script>
  </body>
</html>
